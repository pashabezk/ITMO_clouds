# Лабораторная работа №1
Со звездочкой

### Команда
* Безкоровайный Павел • K34211
* Долматов Дмитрий • K34212
* Коряков Сергей • K34201
* Кубашин Илья • K34211

## Задание
Приложение в запущенном контейнере должно записывать изменения в базу данных. Что именно записать – передаётся в команде запуска контейнера. При остановке контейнера информация не должна исчезать.
Файл должен иметь название, отличное от Dockerfile. (то есть докер файл должен называться не Dockerfile).

## Как запустить:
По пути `./Lab1/Pro/` Необходимо создать env-файл со следующей конфигурацией:
```
DEBUG=1
SECRET_KEY=c%zfe934c9z_w*ee+a%2kpn(c*tb)31br7rlwv9!#95bmb9m(8
DJANGO_ALLOWED_HOSTS=localhost 127.0.0.1 [::1]

SQL_ENGINE=django.db.backends.postgresql
SQL_DATABASE=great_django_db
SQL_USER=siryoja
SQL_PASSWORD=helpmeimdevops
SQL_HOST=db
SQL_PORT=5432
DATABASE=postgres
```

Далее в этой же папке неоходимо сбилидить и запустить контейнер с помощью комманд
```
docker-compose build
docker-compoes up
```
Для остановки контейнеров необходимо выполнить комманду
```
docker-compose stop
```
[Запущенный проект будет разворачиваться на loopback-адрессе на 8000-ом порте](http://localhost:8000/)

## Основная часть

### Выбор проекта для контейнеризации
Для выполнения этой части лабараторной работы было приянто решение сделать простое приложение на языке python с фреймворком Django. Используемая СУБД для реализации взаимодейсвтия код-ДБ - PostgreSQL

Концепция реализации заключается в вызове специального managment-метода при каждом запуске контейнера. Вызов метода производится консольной коммандой через entrypoint-файл, сам метод  производит запись в БД через ORM, которая сразу же отображается на главной странице сервиса.

Код метода: [Тык](./bestdockerappever/writetodb/management/commands/not_execute.py)

### Рабочие файлы
**[/paravoz.Dockerfile](./bestdockerappever/paravoz.Dockerfile)** - отвечает за настройку образа и слоев внутри контейнера, заппускает энтрипоинт для проекта
Внутри этого файла идет установка образа, и выполняются следующие действтия по слоям:
1. Обновление пакетного менеджера и установка необходимой локали
2. Установка необходимого часового пояса
3. Установка драйвера для Postgres-а
4. Установка зависимостей и обновление пакетного менеджера pip
5. Установка утилиты netcat для проверки готовности БД в entrypoint.sh
6. Запуск Энтрипоинта

**[/entrypoint.sh](./bestdockerappever/entrypoint.sh)** -  Представляет собой Bash-скрипт  вызывающийся каждый раз при поднятии контейнера, проверяющий через утилиту netcat готова ли  к использованию база данных. Если таковая готова, то производит миграции в базу данных через manage.py-файл. После выполнения миграций запускает скрипт для записи в базу

**[/docker-compose.yml](./docker-compose.yml)** - Файл, запускающий контейнеры приложения и СУБД, пробрасывает порты для обоих контейнеров, реализует подключение к базе данных через env-файл и создает volume для данных

### Результат
После четырех запусков контейнера записалось четыре новые записи:

<img src='./screen_of_lab.png' width='800'>


